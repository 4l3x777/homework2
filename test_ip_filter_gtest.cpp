#include "gtest/gtest.h"
#include "ip_filter_class.h"
#include "md5.h"
#include <iostream>
#include <string>

using namespace std;

class TestIpFiler : public ::testing::Test {

    string input_data = "113.162.145.156\n157.39.22.224\n79.180.73.190\n179.210.145.4\n219.102.120.135\n67.232.81.208\n85.254.10.197\n23.240.215.189\n1.29.168.152\n185.69.186.168\n110.152.103.161\n185.182.81.131\n68.45.152.8\n114.221.179.117\n185.89.100.249\n46.70.113.73\n188.68.0.38\n119.42.115.97\n194.106.108.214\n24.210.239.177\n166.88.193.116\n62.205.202.214\n188.166.87.191\n103.62.147.2\n95.181.177.197\n95.181.177.197\n149.107.0.27\n182.186.69.18\n73.21.168.251\n113.190.198.73\n91.15.15.33\n188.72.96.184\n50.254.198.161\n98.219.109.151\n123.133.114.213\n89.177.68.136\n89.177.68.136\n65.208.151.112\n183.198.27.25\n187.189.75.118\n188.212.33.157\n94.240.192.2\n69.160.110.157\n81.198.169.232\n185.89.100.47\n46.182.19.219\n183.88.197.193\n49.74.228.23\n124.224.214.76\n107.185.11.105\n41.235.16.95\n68.37.186.197\n188.72.127.199\n173.171.247.113\n173.171.247.113\n49.35.12.51\n67.167.96.234\n204.11.243.70\n182.58.201.28\n168.167.95.164\n153.151.156.27\n79.110.28.59\n37.188.189.227\n188.69.198.152\n98.196.145.69\n68.202.216.62\n68.202.216.62\n68.202.216.62\n5.189.203.79\n197.42.2.124\n95.10.3.43\n180.251.148.71\n113.144.6.220\n89.236.227.204\n67.250.31.212\n67.250.31.212\n177.66.186.82\n107.209.121.224\n213.103.211.108\n27.49.172.153\n78.158.5.183\n78.158.5.183\n27.109.142.224\n103.101.109.70\n117.241.3.153\n86.146.190.166\n68.60.148.11\n89.146.70.220\n171.5.117.72\n66.169.196.128\n5.8.47.226\n165.255.112.201\n207.191.252.36\n123.231.108.232\n185.146.112.69\n187.190.255.160\n187.190.255.160\n191.209.77.60\n58.126.159.88\n222.42.146.225\n193.78.85.148\n66.102.6.107\n5.189.202.254\n188.72.126.149\n185.217.68.210\n190.62.36.205\n190.62.36.205\n114.243.13.43\n128.199.42.73\n5.188.216.44\n74.124.159.77\n103.74.19.104\n183.182.99.139\n188.72.126.153\n173.211.75.241\n163.172.151.47\n180.183.42.174\n93.237.52.162\n60.127.180.251\n84.132.45.217\n37.9.45.225\n82.67.92.27\n123.191.149.173\n73.90.162.151\n178.200.214.178\n70.123.153.26\n177.81.192.15\n47.29.8.38\n123.21.121.123\n73.11.30.103\n73.11.30.103\n112.79.133.183\n151.251.24.30\n47.217.153.6\n47.208.114.106\n93.179.90.113\n149.107.0.31\n188.166.66.232\n64.89.99.122\n116.18.33.248\n211.226.114.169\n69.76.232.100\n69.76.232.100\n69.76.232.100\n69.76.232.100\n193.70.91.227\n191.101.165.168\n195.205.28.27\n177.81.184.55\n24.163.91.199\n197.48.69.176\n45.127.57.74\n14.169.83.98\n47.11.217.253\n222.173.235.246\n172.2.146.147\n67.183.246.205\n218.185.237.250\n74.136.5.194\n14.187.212.140\n149.3.43.228\n141.101.132.191\n189.216.159.43\n5.8.47.84\n50.26.133.146\n83.221.180.18\n117.213.109.57\n109.193.71.64\n46.70.147.26\n188.166.49.134\n117.198.224.130\n77.179.162.181\n27.251.253.58\n75.69.188.107\n198.48.136.200\n186.92.150.52\n184.170.28.62\n47.44.49.2\n24.23.88.218\n24.23.88.218\n220.180.121.6\n99.114.89.48\n116.25.102.111\n93.183.170.145\n47.29.254.116\n18.248.2.85\n141.101.132.73\n47.220.163.51\n47.220.163.51\n123.20.104.253\n184.183.34.140\n128.199.99.114\n93.179.90.77\n5.62.159.66\n87.118.92.43\n185.14.194.116\n161.0.198.138\n49.118.223.200\n188.72.126.130\n42.54.29.150\n14.182.208.223\n14.182.208.223\n73.197.19.19\n49.206.125.56\n67.165.212.104\n71.90.169.184\n117.207.33.172\n195.234.85.219\n5.152.151.166\n90.191.74.74\n184.58.77.155\n104.218.63.75\n117.3.82.3\n188.211.226.16\n107.175.234.130\n85.253.112.79\n190.213.37.222\n70.234.198.76\n70.234.198.76\n5.188.216.204\n69.251.6.155\n93.34.197.129\n5.8.47.202\n14.162.206.233\n1.231.69.33\n69.23.42.183\n63.87.226.66\n5.254.65.190\n37.33.109.179\n1.1.234.8\n119.201.4.165\n179.218.84.120\n5.101.217.139\n96.92.198.213\n96.92.198.213\n117.248.24.152\n85.253.148.39\n27.70.17.38\n211.225.89.44\n184.91.78.121\n95.181.176.189\n178.6.12.226\n131.221.56.20\n84.108.11.149\n164.126.188.157\n107.223.148.60\n218.7.166.58\n177.42.212.125\n191.101.54.77\n191.101.54.77\n94.30.173.135\n92.105.136.141\n41.159.26.123\n24.191.211.63\n202.74.243.112\n108.73.108.163\n67.188.13.100\n123.20.181.120\n179.211.81.134\n64.40.152.168\n68.43.142.235\n173.211.75.62\n50.81.221.73\n103.203.133.202\n47.74.157.18\n84.252.26.213\n84.252.26.213\n71.234.84.132\n186.125.174.10\n113.182.239.185\n106.67.36.120\n189.100.88.211\n184.170.35.121\n181.215.20.38\n185.3.147.64\n187.64.27.167\n73.55.95.93\n45.32.140.209\n37.110.213.11\n177.32.68.231\n203.192.225.115\n189.181.251.184\n82.199.206.151\n73.224.202.251\n75.90.211.217\n173.211.75.55\n115.221.10.154\n190.39.83.68\n112.124.39.77\n5.189.200.175\n181.169.25.33\n202.166.194.217\n108.18.251.109\n188.72.127.216\n76.94.181.14\n141.196.77.153\n69.227.160.129\n5.101.221.37\n59.42.27.180\n188.68.0.207\n173.24.113.249\n173.24.113.249\n14.231.56.112\n5.62.159.140\n141.101.132.179\n95.90.191.205\n193.93.192.122\n75.65.190.40\n91.204.190.7\n131.129.231.39\n186.86.29.56\n91.135.176.211\n154.160.1.180\n83.143.86.155\n60.7.107.169\n89.249.207.229\n95.181.176.155\n95.181.176.155\n41.199.158.154\n36.5.146.30\n217.72.94.100\n217.72.94.100\n217.72.94.100\n217.72.94.100\n217.72.94.100\n14.231.214.53\n89.163.155.202\n85.187.105.45\n77.13.117.195\n70.91.13.106\n126.241.3.145\n114.249.117.72\n113.173.67.60\n183.87.196.93\n49.203.248.26\n49.203.248.26\n185.89.100.59\n95.181.177.241\n125.43.69.142\n37.186.67.25\n185.46.85.204\n73.91.213.154\n111.61.78.76\n75.114.69.42\n95.181.177.50\n95.90.254.195\n109.192.168.38\n5.101.217.48\n86.34.133.118\n46.101.163.119\n189.6.128.228\n202.9.43.222\n202.142.76.12\n105.73.25.26\n119.184.218.145\n179.219.241.71\n156.212.169.72\n103.66.196.13\n68.41.149.247\n117.102.78.2\n14.186.245.237\n93.179.90.24\n39.88.253.245\n187.3.66.189\n24.17.1.75\n24.17.1.75\n188.72.127.249\n46.161.60.92\n72.77.71.111\n114.47.230.91\n177.87.9.192\n49.156.211.218\n187.65.248.41\n73.244.53.54\n117.213.254.4\n187.39.197.81\n78.84.243.190\n188.72.126.152\n141.101.132.158\n178.253.240.126\n46.101.127.145\n154.16.89.9\n139.167.0.12\n168.196.9.47\n107.77.72.118\n72.181.175.235\n72.181.175.235\n104.222.165.144\n98.214.16.13\n171.221.113.228\n46.55.46.98\n47.39.211.31\n45.248.186.76\n77.234.45.173\n185.163.24.76\n113.89.239.241\n113.206.92.243\n107.167.109.164\n185.46.86.131\n185.46.86.131\n75.171.214.8\n95.181.176.240\n95.181.176.240\n217.159.171.6\n195.250.178.88\n89.236.251.247\n68.46.218.208\n71.88.10.118\n176.90.14.232\n99.251.8.64\n101.98.164.130\n71.52.72.142\n84.15.185.66\n45.124.191.237\n168.195.231.1\n73.141.213.207\n78.171.131.126\n73.166.52.138\n73.166.52.138\n103.203.241.89\n188.68.0.102\n108.30.39.3\n108.30.39.3\n191.207.27.171\n123.116.254.111\n113.77.173.249\n81.151.71.218\n191.191.197.98\n188.166.49.134\n108.180.26.133\n108.180.26.133\n45.62.234.109\n177.43.57.48\n95.181.176.136\n117.196.197.139\n23.240.217.243\n70.180.91.246\n159.203.13.174\n186.46.222.194\n141.101.132.93\n186.179.100.193\n181.215.16.39\n114.95.157.203\n189.7.220.132\n189.251.241.73\n172.97.129.82\n64.237.226.172\n50.32.39.122\n37.201.203.88\n170.80.252.30\n89.170.3.145\n156.204.84.209\n78.84.60.71\n78.84.60.71\n78.84.60.71\n78.10.207.6\n99.169.226.169\n99.169.226.169\n99.169.226.169\n99.169.226.169\n73.104.80.103\n73.104.80.103\n79.206.209.45\n103.220.209.173\n66.249.92.198\n47.16.77.236\n89.38.96.66\n75.206.129.73\n129.56.12.56\n5.8.47.44\n193.24.92.54\n156.222.243.190\n176.228.138.151\n176.228.138.151\n176.228.138.151\n181.122.209.200\n35.193.144.59\n101.24.171.210\n188.68.0.185\n113.195.165.235\n41.242.141.134\n146.185.206.53\n95.181.177.111\n67.174.152.35\n78.100.196.199\n220.132.196.75\n14.167.215.198\n66.183.9.162\n189.62.20.66\n68.172.234.141\n1.87.203.225\n32.215.162.52\n32.215.162.52\n32.215.162.52\n5.62.159.232\n81.213.167.197\n180.246.83.253\n91.204.14.185\n49.213.19.115\n74.116.59.8\n202.129.0.27\n94.141.76.33\n37.110.210.153\n125.165.131.226\n61.74.152.228\n61.74.152.228\n217.174.230.98\n173.225.247.123\n77.68.40.185\n182.75.81.122\n182.75.81.122\n79.184.219.107\n97.95.65.151\n49.213.19.137\n118.114.86.199\n175.192.51.84\n97.82.75.243\n72.79.56.37\n117.2.125.26\n193.194.132.76\n119.15.93.202\n119.15.93.202\n119.15.93.202\n107.174.108.194\n103.207.242.56\n78.109.65.21\n171.77.145.44\n45.123.220.122\n5.189.202.198\n88.91.160.177\n149.154.167.161\n109.75.90.41\n188.97.225.180\n76.112.220.160\n5.101.221.76\n114.125.118.9\n188.237.136.152\n213.225.6.88\n14.187.178.209\n46.251.197.23\n189.121.253.246\n109.127.20.122\n118.96.117.80\n27.97.226.94\n96.94.121.25\n5.8.47.202\n46.161.56.203\n193.136.199.50\n121.27.48.172\n36.67.5.186\n89.28.76.171\n46.161.56.174\n188.2.221.111\n85.253.176.102\n79.15.208.108\n5.62.154.58\n85.114.239.251\n46.161.56.106\n46.161.56.106\n67.5.105.174\n181.215.0.59\n95.181.176.58\n72.193.106.165\n217.61.224.38\n185.89.100.44\n188.72.126.41\n46.70.225.39\n80.133.65.104\n82.196.6.103\n185.158.116.188\n94.30.155.174\n5.101.219.107\n197.48.89.171\n164.132.3.102\n79.100.201.157\n47.11.7.112\n82.32.174.146\n189.217.133.144\n146.185.177.103\n217.25.18.126\n5.62.154.52\n187.188.129.136\n217.82.152.217\n106.51.30.215\n68.106.156.3\n109.185.152.20\n45.247.3.119\n108.171.129.171\n189.102.186.9\n189.175.155.108\n103.28.36.56\n212.56.210.90\n204.232.108.181\n85.180.234.65\n188.166.49.33\n188.166.72.33\n156.220.35.15\n41.227.84.129\n188.68.0.30\n176.12.58.180\n85.118.110.10\n162.247.72.217\n67.205.174.171\n185.89.217.170\n176.241.89.82\n123.23.148.249\n123.23.148.249\n183.147.179.187\n111.222.25.83\n91.204.14.239\n60.174.233.154\n157.37.38.188\n50.80.193.175\n37.221.176.236\n118.69.205.201\n113.173.98.95\n5.146.199.53\n213.213.103.190\n141.101.132.120\n171.221.26.73\n188.68.0.171\n151.53.178.221\n146.185.204.136\n117.209.246.210\n193.40.12.10\n77.215.105.50\n122.40.163.51\n182.69.22.32\n95.181.176.30\n188.72.96.177\n108.49.29.94\n108.49.29.94\n23.254.17.73\n46.161.61.51\n73.175.73.131\n79.208.172.72\n36.102.236.203\n95.90.254.195\n138.122.123.42\n126.218.40.164\n5.62.153.169\n83.128.50.47\n83.128.50.47\n78.129.149.3\n78.129.149.3\n146.255.242.234\n14.177.248.167\n213.219.115.76\n185.46.87.231\n188.72.96.77\n109.91.38.1\n201.219.180.58\n85.65.43.232\n73.87.94.81\n73.87.94.81\n5.62.154.49\n162.236.216.26\n190.198.255.34\n183.88.77.2\n95.181.177.213\n73.76.58.22\n47.149.142.171\n47.149.142.171\n119.55.121.74\n188.209.233.110\n188.209.233.110\n181.215.6.120\n181.215.6.120\n61.98.171.199\n187.187.193.21\n165.225.81.66\n98.64.84.57\n46.161.63.66\n67.215.250.146\n103.251.226.120\n199.249.223.75\n47.11.7.240\n117.200.96.91\n191.101.54.244\n95.89.126.115\n203.249.55.94\n49.34.5.58\n14.97.7.246\n2.29.170.242\n14.17.122.207\n185.213.20.252\n73.185.49.225\n47.11.210.118\n14.232.172.139\n5.101.222.205\n134.48.22.110\n93.179.90.237\n171.6.156.117\n171.6.156.117\n185.117.149.113\n46.161.58.202\n191.101.145.250\n191.101.145.250\n116.68.105.105\n125.163.151.121\n81.198.25.242\n92.161.182.241\n194.208.63.191\n90.114.80.144\n5.189.200.116\n186.182.82.240\n122.15.212.146\n122.15.212.146\n122.15.212.146\n137.97.9.40\n189.122.18.125\n187.188.28.45\n190.9.214.105\n222.130.177.64\n123.136.249.120\n178.220.115.243\n14.102.246.210\n178.119.240.143\n98.89.83.30\n50.106.25.168\n185.89.217.189\n5.62.159.38\n186.95.24.238\n5.189.202.171\n71.223.161.63\n14.207.158.135\n216.239.90.19\n176.153.26.5\n99.61.192.35\n73.48.161.172\n73.48.161.172\n73.48.161.172\n188.166.82.41\n117.5.75.127\n183.83.78.172\n172.243.2.129\n84.146.103.72\n5.101.217.177\n110.167.197.122\n5.189.203.43\n95.213.218.108\n185.46.86.22\n191.101.54.127\n194.135.166.12\n79.237.168.168\n45.32.108.44\n186.204.34.46\n117.5.211.1\n69.57.247.218\n70.121.9.224\n209.107.214.71\n189.34.176.93\n80.78.237.5\n14.186.176.190\n84.108.20.44\n176.126.83.77\n104.174.173.170\n219.92.33.137\n78.48.70.89\n186.37.202.178\n71.223.241.223\n71.223.241.223\n73.140.229.40\n188.188.19.204\n195.154.232.98\n112.28.106.231\n62.219.224.250\n93.171.216.68\n37.26.142.184\n87.255.69.86\n87.255.69.86\n157.48.15.35\n50.3.197.73\n23.27.228.81\n190.56.99.94\n76.228.35.48\n5.8.47.100\n110.77.199.103\n54.205.123.87\n183.89.22.222\n14.139.41.109\n186.43.29.31\n173.31.96.193\n173.31.96.193\n77.79.38.5\n95.85.80.229\n191.101.144.238\n50.25.139.252\n50.25.139.252\n177.82.171.180\n113.87.26.63\n77.181.225.187\n103.89.255.122\n107.222.35.45\n200.125.116.65\n202.5.196.66\n158.181.40.154\n86.115.0.94\n68.108.194.244\n68.108.194.244\n68.108.194.244\n110.87.118.235\n105.158.16.153\n188.72.96.182\n14.187.132.10\n85.253.45.35\n188.166.36.54\n111.37.37.235\n111.37.37.235\n79.184.223.137\n34.214.132.226\n74.96.79.23\n188.166.41.162\n117.5.169.43\n76.221.68.186\n185.89.100.48\n74.132.249.206\n91.126.205.238\n5.62.159.143\n188.146.232.177\n188.68.3.92\n200.5.83.150\n93.179.90.116\n94.185.80.235\n188.104.116.79\n177.232.136.107\n123.16.114.132\n178.254.168.220\n66.249.93.2\n96.30.65.207\n73.84.200.187\n70.35.215.94\n139.0.6.42\n185.46.86.132\n89.177.29.121\n118.44.17.181\n146.185.204.191\n146.185.204.191\n190.111.195.137\n146.185.206.106\n185.2.32.173\n96.31.53.251\n207.41.189.106\n36.63.28.208\n31.170.161.42\n209.107.196.159\n185.46.85.78\n183.12.241.137\n184.167.219.223\n177.34.62.115\n5.189.200.201\n47.11.5.9\n179.218.5.141\n5.62.159.25\n32.209.238.246\n32.209.238.246\n32.209.238.246\n32.209.238.246\n46.70.29.76\n104.222.164.236\n194.152.37.147\n177.80.227.215\n5.101.217.197\n47.8.5.240\n192.40.95.34\n103.244.252.242\n185.89.100.129\n178.82.94.82\n202.100.206.36\n45.249.48.124\n84.42.249.4\n62.12.93.76\n77.93.192.43\n141.101.132.50\n89.201.7.164\n5.15.220.203\n185.69.186.227\n24.193.178.168\n65.26.31.140\n83.99.166.35\n103.254.155.74\n49.34.2.43\n91.142.208.226\n193.93.192.134\n188.68.0.249\n79.110.28.78\n71.211.2.230\n188.72.127.48\n185.217.68.209\n99.242.220.241\n5.62.159.148\n1.70.44.170\n191.23.199.126\n98.242.127.228\n59.99.48.248\n67.191.200.150\n213.6.149.66\n77.109.86.105\n123.30.177.138\n185.14.194.82\n39.46.86.85\n220.189.194.162\n5.189.200.97\n24.91.41.150\n209.197.20.206\n12.155.92.10\n12.155.92.10\n205.186.180.34\n46.161.60.35\n73.115.6.159\n222.82.198.61\n213.200.15.167\n5.101.220.79\n98.122.86.197\n14.231.215.204\n76.94.77.14\n73.58.220.10\n73.58.220.10\n73.58.220.10\n193.93.192.165\n189.122.214.227\n191.101.54.148\n84.109.80.89\n84.109.80.89\n84.109.80.89\n70.95.65.80\n70.95.65.80\n70.95.65.80\n113.182.18.30\n113.182.18.30\n144.217.161.119\n46.223.254.56\n46.223.254.56\n71.90.148.209\n156.220.69.153\n158.181.19.102\n59.84.240.60\n95.181.176.106\n189.120.152.120\n153.136.8.214\n101.21.80.126\n198.73.50.71\n68.227.43.14\n172.248.74.10\n172.248.74.10\n46.161.56.241\n66.249.93.49\n59.89.245.157\n163.172.73.168\n5.62.154.110\n61.148.243.183\n81.171.81.234\n81.171.81.234\n5.189.203.46\n197.48.60.53\n46.49.43.85\n73.115.17.146\n193.93.192.192\n193.93.192.192\n146.185.206.166\n69.245.162.12\n69.245.162.12\n69.245.162.12\n69.245.162.12\n189.33.47.50\n95.42.141.179\n95.42.141.179\n180.66.236.162\n162.13.152.211\n99.109.226.233\n217.78.6.205\n79.235.120.32\n187.37.143.79\n158.135.163.135\n5.101.219.197\n158.140.180.27\n142.118.105.137\n72.201.118.80\n112.215.243.201\n187.137.61.82\n179.218.101.97\n181.215.39.116\n82.45.10.45\n205.185.209.141\n180.241.150.70\n5.101.221.20\n188.68.0.19\n47.183.128.151\n47.183.128.151\n103.252.169.182\n162.237.21.238\n103.240.127.33\n171.4.234.224\n76.118.206.235\n37.142.228.191\n67.183.105.87\n67.183.105.87\n67.183.105.87\n91.64.189.196\n93.179.90.82";

    streambuf* old_stdout{nullptr};
    vector<vector<string>> in_pool;

protected:

	void SetUp()
	{
        old_stdout = std::cout.rdbuf(new_stdout.rdbuf());
        auto lines = split(input_data, '\n');
        for (auto& line : lines) { in_pool.push_back(split(line, '.'));}  
		IpFilterInstance = new IpFilter(in_pool);
	}

	void TearDown()
	{
        old_stdout = std::cout.rdbuf(old_stdout);
		delete IpFilterInstance;
	}

	IpFilter* IpFilterInstance;
    stringstream new_stdout;
};

TEST_F(TestIpFiler, test_hash)
{
	IpFilterInstance->reverse_lexicographically_sort();
    IpFilterInstance->filter(1);
    IpFilterInstance->filter(46, 70);
    IpFilterInstance->filter_any(46);
	ASSERT_EQ(MD5(new_stdout.str()).toStr(), string("24e7a7b2270daee89c64d3ca5fb3da1a"));
}

int main(int argc, char *argv[])
{
	::testing::InitGoogleTest(&argc, argv);
	return RUN_ALL_TESTS();
}